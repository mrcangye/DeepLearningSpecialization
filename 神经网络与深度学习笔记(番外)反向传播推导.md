# 神经网络与深度学习笔记(番外)反向传播推导

## 回顾

我们设 $n^{[l]}$ 为第 $l$ 层的单元数

则它们的维数
$$
w^{[l]}, dw ：(n^{[l]},n^{[l-1]})\\
$$

$$
b^{[l]}, db ：(n^{[l]},1)\\
$$

$$
z^{[l]},a^{l}:(n^{[l]},1)\\
$$

$$
Z^{l},A^{l},dZ,dA:(n^{[l]},m)
$$



反向传播公式为：
$$
dz^{[l]} = da^{[l]} * g^{[l]'}(z^{[l]})\\
$$

$$
dw^{[l]} = dz^{[l]} * a^{[l-1]}\\
$$

$$
db^{[l]} = dz^{[l]}\\
$$

$$
da^{[l-1]} = w^{[l]^{T}}*dz^{[l]}
$$

## 推导

首先我们知道
$$
z^{[l]} = w^{[l]}*a^{[l-1]} + b^{[l]}
$$

$$
a^{[l]} = g^{[l]}(z^{[l]})
$$

$$
\jmath(a,y) = - yloga-(1-y)log(1-a)\\
$$

接下来开始推导过程：

### $dz^{[l]}$的证明

由公式   $\jmath(a,y) = - yloga-(1-y)log(1-a)\\$ 对 $a$ 求导得：
$$
\frac{d\jmath(a^{[l]},y)}{da^{[l]}} = -\frac{y}{a^{[l]}} + \frac{1-y}{1-a^{[l]}}\\
$$

$$
\frac{d\jmath(a^{[l]},y)}{dz^{[l]}} = \frac{d\jmath(a^{[l]},y)}{da^{[l]}}*\frac{da^{[l]}}{dz^{[l]}}
$$



而
$$
\frac{da^{[l]}}{dz^{[l]}} = g^{[l]'}(z^{[l]})
$$
所以代入公式  中得：
$$
\frac{d\jmath(a^{[l]},y)}{dz^{[l]}} =da^{[l]}*g^{[l]'}(z^{[l]})
$$
注意：上式子中的 $da^{[l]}$ 为简写，实际上是：
$$
\frac{d\jmath(a^{[l]},y)}{da^{[l]}}
$$
后面的$dz^{[l]}, dw^{[l]}, db^{[l]}$ 同理

即证明了公式  $dz^{[l]} = da^{[l]} * g^{[l]'}(z^{[l]})\\$

### $dw^{[l]}$的证明

由
$$
\frac{d\jmath(a^{[l]},y)}{dz^{[l]}} =da^{[l]}*g^{[l]'}(z^{[l]})
$$
的证明结果，我们来推一下 $dw^{[l]}$
$$
\frac{d\jmath(a^{[l]},y)}{dw^{[l]}} =\frac{d\jmath(a^{[l]},y)}{dz^{[l]}} * \frac{dz^{[l]}}{dw^{[l]}}
$$
因为：
$$
z^{[l]} = w^{[l]}*a^{[l-1]} + b^{[l]}\\
$$
所以：
$$
\frac{dz^{[l]}}{dw^{[l]}} = a^{[l-1]}
$$


故：
$$
\frac{d\jmath(a^{[l]},y)}{dw^{[l]}} =\frac{d\jmath(a^{[l]},y)}{dz^{[l]}} * \frac{dz^{[l]}}{dw^{[l]}}=dz^{[l]}*a^{[l-1]}
$$

### $db^{[l]}$ 的证明

由
$$
\frac{d\jmath(a^{[l]},y)}{dz^{[l]}} =da^{[l]}*g^{[l]'}(z^{[l]})
$$
的证明结果，我们来推一下 $db^{[l]}$
$$
\frac{d\jmath(a^{[l]},y)}{db^{[l]}} =\frac{d\jmath(a^{[l]},y)}{dz^{[l]}} * \frac{dz^{[l]}}{db^{[l]}}
$$
因为：
$$
z^{[l]} = w^{[l]}*a^{[l-1]} + b^{[l]}\\
$$
所以：
$$
\frac{dz^{[l]}}{db^{[l]}} = 1
$$
故：
$$
\frac{d\jmath(a^{[l]},y)}{db^{[l]}} =\frac{d\jmath(a^{[l]},y)}{dz^{[l]}} * \frac{dz^{[l]}}{db^{[l]}}=dz^{[l]}
$$

### $da^{[l-1]}$ 的证明

由
$$
\frac{d\jmath(a^{[l]},y)}{dz^{[l]}} =da^{[l]}*g^{[l]'}(z^{[l]})
$$
的证明结果，我们来推一下 $da^{[l-1]}$
$$
\frac{d\jmath(a^{[l]},y)}{da^{[l-1]}} =\frac{d\jmath(a^{[l]},y)}{dz^{[l]}} * \frac{dz^{[l]}}{da^{[l-1]}}
$$
因为：
$$
z^{[l]} = w^{[l]}*a^{[l-1]} + b^{[l]}\\
$$
所以：
$$
\frac{dz^{[l]}}{da^{[l-1]}} = w^{[l]}
$$
故：
$$
\frac{d\jmath(a^{[l]},y)}{da^{[l-1]}} =\frac{d\jmath(a^{[l]},y)}{dz^{[l]}} * \frac{dz^{[l]}}{da^{[l-1]}}=w^{[l]^{T}}*dz^{[l]}
$$
会不会觉得很奇怪？

为什么 $w^{[l]^{T}}$ 是个转置？


$$
w^{[l]}, dw ：(n^{[l]},n^{[l-1]})\\
$$

$$
b^{[l]}, db ：(n^{[l]},1)\\
$$

$$
z^{[l]},a^{l}:(n^{[l]},1)\\
$$

因为我们还要考虑维度的问题，

$w^{[l]}$ 维度为 $(n^{[l]},n^{[l-1]})$

$z^{[l]}$维度为$(n^{[l]},1)$

$da^{[l-1]}$ 维度为 $(n^{[l]},1)$

故要使得 $w^{[l]}$ 与 $z^{[l]}$ 的积等于 $da^{[l-1]}$ ，我们需要将$w^{[l]}$ 转置，转置后的 $w^{[l]^{T}}$ 维度为 $(n^{[l]},n^{[l-1]})$ ，才可以使得等式成立，且维度一致。
